<%= form_for(@dish, :html => { :multipart => true, :class => "directUpload" }) do |f| %>

<span id='hideAfter'>


  <div class="form-group">
    <%= f.label :image %>
      <div id="instaject-outer" style="padding: 10px; display: none;"> <!-- style="display: none;"> -->
        <div id="instaject"></div>
      </div>


    <div class="field">
      <%= f.label :image %><br>
      <%= f.file_field :image %>
    </div>


      <% if session[:access_token].nil? %>
        <a href="/oauth/connect">
            <button class="button btn btn-primary" id="instagram-connect">
                <i class="fa fa-instagram"></i>
                Connect to Instagram
            </button>
        </a>
      <% end %>


    <div class="file-field input-field">
      <input class="file-path form-control" type="text"/>
      <div class="btn">
        <span style="padding-right: 10px">File</span>
        <input id="dish_image" name="dish[image]" type="file" />
      </div>
    </div>



  </div>

  <div class="form-group">



          <span id="spannerbutton">
        <%= tag "input", { "type" => "button", class: "btn btn-success", "value" => "Instagram Upload", "onclick" => "instaModalSingle();" } %> 
      </span>
  </div>
</span>

  <%= f.hidden_field :image_url, :id => "imageURL" %>

  <div class="form-group"> 
    <%= f.label :name %>
    <%= f.text_field :name, class: "form-control" %>
  </div> 
  
  <div class="form-group"> 
    <%= f.label :description %>
    <%= f.text_field :description, class: "form-control" %>
  </div>

  <div class="form-group"> 
    <%= f.label :price %>
    <%= f.number_field :price, class: "form-control" %>
  </div> 

  <div class="actions"> 
    <%= f.submit :class => "btn btn-success" %>
  </div> 

<% end %>

<script>
    $(function() {
        $('.directUpload').find("input:file").each(function(i, elem) {
            var fileInput    = $(elem);
            var form         = $(fileInput.parents('form:first'));
            var submitButton = form.find('input[type="submit"]');
            var progressBar  = $("<div class='bar'></div>");
            var barContainer = $("<div class='progress'></div>").append(progressBar);
            fileInput.after(barContainer);
            fileInput.fileupload({
                fileInput:       fileInput,
                url:             '<%= @s3_direct_post.url %>',
                type:            'POST',
                autoUpload:       true,
                formData:         <%= @s3_direct_post.fields.to_json.html_safe %>,
                paramName:        'file', // S3 does not like nested name fields i.e. name="user[avatar_url]"
                dataType:         'XML',  // S3 returns XML if success_action_status is set to 201
                replaceFileInput: false
            });
        });
    });
</script>